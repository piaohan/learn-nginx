(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{268:function(e,t,_){"use strict";_.r(t);var n=_(28),o=Object(n.a)({},(function(){var e=this,t=e.$createElement,_=e._self._c||t;return _("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[_("h1",{attrs:{id:"node-js-反向代理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#node-js-反向代理"}},[e._v("#")]),e._v(" Node.js 反向代理")]),e._v(" "),_("p",[e._v("服务端如果使用"),_("code",[e._v("nodejs")]),e._v("运行服务，由于端口不能同时多个服务占用，而服务器中可能又是多个网站，那么可以使用 Nginx 做反向代理，比如有这些网站域名和端口：")]),e._v(" "),_("table",[_("thead",[_("tr",[_("th",[e._v("域名")]),e._v(" "),_("th",[e._v("端口")])])]),e._v(" "),_("tbody",[_("tr",[_("td",[e._v("www.xxoo.com")]),e._v(" "),_("td",[e._v("8001")])]),e._v(" "),_("tr",[_("td",[e._v("www.xo.com")]),e._v(" "),_("td",[e._v("8002")])]),e._v(" "),_("tr",[_("td",[e._v("www.xo.cn")]),e._v(" "),_("td",[e._v("8003")])])])]),e._v(" "),_("p",[e._v("当然一个服务器上的网站可能还有更多，可以通过配置 Nginx 转发来代理这些端口分发，如：")]),e._v(" "),_("div",{staticClass:"language-conf extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[e._v('server {\n    server_name www.xxoo.com;\n    listen 80;\n\n    # 设置这个网站的根目录\n    root /wwwroot/www.xxoo.com/;\n\n    # 由于下面配置了文件不存在则代码到 Node.js 中，那么直接访问目录（不带默认主页）的话会有问题，这里做下判断\n    # 如果访问目录下有 index.html 文件，则直接重写到该文件\n    # break 表示重写且停止，但 url 不变，而 permanent 表示301重定向，url 会更新\n    if ( -f $request_filename/index.html ){\n        rewrite (.*) $1/index.html break;\n    }\n\n    # 如果请求的文件不存在，则代理到 Node.js\n    if ( !-f $request_filename ){\n        rewrite (.*) /index.js;\n    }\n\n    # 代理node服务 8001\n    location = /index.js {\n        # 设置一些代理的header信息，这些信息将被透传到 Node.js 服务的header信息里\n        proxy_set_header Connection "";\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header X-NginX-Proxy true;\n\n        # 代理服务\n        proxy_pass http://127.0.0.1:8001$request_uri;\n\n        # 忽略其他重写\n        proxy_redirect off;\n    }\n}\n')])])]),_("p",[e._v("配置之后，比如你网站根目录里有 "),_("code",[e._v("index.html")]),e._v(" 文件，访问 "),_("code",[e._v("url")]),e._v(" 如：")]),e._v(" "),_("table",[_("thead",[_("tr",[_("th",[e._v("访问链接")]),e._v(" "),_("th",[e._v("解析过程")]),e._v(" "),_("th",[e._v("备注")])])]),e._v(" "),_("tbody",[_("tr",[_("td",[e._v("www.xxoo.com/index.html")]),e._v(" "),_("td",[e._v("Nginx")]),e._v(" "),_("td",[e._v("由于文件存在，直接使用 Nginx 输出")])]),e._v(" "),_("tr",[_("td",[e._v("www.xxoo.com")]),e._v(" "),_("td",[e._v("Nginx")]),e._v(" "),_("td",[e._v("由于判断该目录下有 "),_("code",[e._v("index.html")]),e._v(" 文件，则自动重写到该文件，但 "),_("code",[e._v("url")]),e._v(" 不变")])]),e._v(" "),_("tr",[_("td",[e._v("www.xxoo.com/xx.html")]),e._v(" "),_("td",[e._v("Nginx -> Node.js:8001")]),e._v(" "),_("td",[e._v("由于文件不存在，使用 Nginx 代理到 Node.js 的 8001 端口")])]),e._v(" "),_("tr",[_("td",[e._v("www.xxoo.com/xxoo/")]),e._v(" "),_("td",[e._v("Nginx -> Node.js:8001")]),e._v(" "),_("td",[e._v("首先判断该目录是否存在"),_("br"),e._v("如果存在再判断是否有 "),_("code",[e._v("index.html")]),e._v(" 文件"),_("br"),e._v("一旦不成立，直接代理到 Node.js")])])])])])}),[],!1,null,null,null);t.default=o.exports}}]);