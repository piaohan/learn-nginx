(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{255:function(e,o,t){"use strict";t.r(o);var a=t(28),n=Object(a.a)({},(function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"学习使用-echo-模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#学习使用-echo-模块"}},[e._v("#")]),e._v(" 学习使用 echo 模块")]),e._v(" "),t("p",[e._v("Nginx echo模块是在nginx程序上扩展了 "),t("code",[e._v("echo")]),e._v(" 输出字符的功能，对于调试很方便，项目地址: "),t("a",{attrs:{href:"https://github.com/openresty/echo-nginx-module",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/openresty/echo-nginx-module"),t("OutboundLink")],1),e._v(" 。")]),e._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),t("blockquote",[t("p",[e._v("目前支持 "),t("code",[e._v("nginx-1.11.2")]),e._v("，高版本可能安装失败，我装 "),t("code",[e._v("1.11.13")]),e._v(" 失败了，更多支持nginx的版本见: "),t("a",{attrs:{href:"https://github.com/openresty/echo-nginx-module#compatibility",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/openresty/echo-nginx-module#compatibility"),t("OutboundLink")],1)])]),e._v(" "),t("p",[e._v("去 "),t("a",{attrs:{href:"https://github.com/openresty/echo-nginx-module/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("release"),t("OutboundLink")],1),e._v(" 下载最新的安装包，并解压.")]),e._v(" "),t("p",[e._v("在配置 Nginx 时用: "),t("code",[e._v("./configure --add-module=/你的解压路径")]),e._v("，并编译安装，如果是重新编译安装可参考: "),t("RouterLink",{attrs:{to:"/guide/linux-install.html#重新编译安装"}},[e._v("重新编译安装")])],1),e._v(" "),t("h2",{attrs:{id:"使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[e._v("#")]),e._v(" 使用")]),e._v(" "),t("blockquote",[t("p",[e._v("只是研究了一些常用的")])]),e._v(" "),t("h3",{attrs:{id:"echo-输出字符"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#echo-输出字符"}},[e._v("#")]),e._v(" echo - 输出字符")]),e._v(" "),t("ul",[t("li",[e._v("语法: "),t("code",[e._v("echo [options] <string>...")])]),e._v(" "),t("li",[e._v("默认值: "),t("code",[e._v("no")])])]),e._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('# 简单的hello，world!\nserver {\n    location = /api/hello {\n        echo "hello，world!";\n    }\n}\n')])])]),t("p",[e._v("默认echo会自动换行，不需要换行可以: "),t("code",[e._v("echo -n xxx;")]),e._v(";")]),e._v(" "),t("h3",{attrs:{id:"echo-before-body，echo-after-body-页面前、后插入内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#echo-before-body，echo-after-body-页面前、后插入内容"}},[e._v("#")]),e._v(" echo_before_body，echo_after_body - 页面前、后插入内容")]),e._v(" "),t("ul",[t("li",[e._v("语法: "),t("code",[e._v("echo_before_body [options] [argument]...")])]),e._v(" "),t("li",[e._v("默认值: "),t("code",[e._v("no")])])]),e._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('server {\n    # 简单的输出\n    location = /api/hello {\n        echo_before_body echo_before_body;\n        echo "hello，world!";\n        echo_after_body echo_after_body;\n    }\n\n    # 常见于代理页面前、后插内容\n    location = /api/proxy_before_after {\n        echo_before_body echo_before_body;\n        echo_before_body echo_before_body;\n        proxy_pass http://127.0.0.1;\n        echo_after_body echo_after_body;\n        echo_after_body echo_after_body;\n    }\n}\n')])])]),t("h3",{attrs:{id:"echo-sleep-请求等待"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#echo-sleep-请求等待"}},[e._v("#")]),e._v(" echo_sleep - 请求等待")]),e._v(" "),t("ul",[t("li",[e._v("语法: "),t("code",[e._v("echo_sleep <seconds>")])]),e._v(" "),t("li",[e._v("默认值: "),t("code",[e._v("no")])])]),e._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("server {\n    # 简单的输出\n    location = /api/sleep {\n        echo 1;\n\n        # 等待1秒\n        echo_sleep 1;\n\n        echo 2;\n    }\n}\n")])])]),t("h3",{attrs:{id:"echo-location-async，echo-location-请求指定路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#echo-location-async，echo-location-请求指定路径"}},[e._v("#")]),e._v(" echo_location_async，echo_location - 请求指定路径")]),e._v(" "),t("ul",[t("li",[e._v("语法: "),t("code",[e._v("echo_location_async <location> [<url_args>]")])]),e._v(" "),t("li",[e._v("默认值: "),t("code",[e._v("no")])])]),e._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("location /main {\n    # 异步调用/sub\n    echo_location_async /sub;\n\n    echo world;\n}\n\nlocation /main2 {\n    # 同步调用/sub\n    echo_location_async /sub;\n\n    echo world;\n}\n\nlocation /sub {\n    echo hello;\n}\n")])])]),t("p",[e._v("异步跟同步的区别是:")]),e._v(" "),t("ol",[t("li",[e._v("异步会并行的去请求")]),e._v(" "),t("li",[e._v("同步等待当前请求结束才会往下执行")])]),e._v(" "),t("p",[e._v("下面这个整个时间为2s，因为新路径最大是2s:")]),e._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(' location /main {\n     echo_location_async /sub1;\n     echo_location_async /sub2;\n     echo "took $echo_timer_elapsed sec for total.";\n }\n location /sub1 {\n     echo_sleep 2;\n }\n location /sub2 {\n     echo_sleep 1;\n }\n')])])]),t("p",[e._v("下面这个整个时间为3s，因为需要等待"),t("code",[e._v("/sub1")]),e._v("完成才进入"),t("code",[e._v("/sub2")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(' location /main {\n     echo_location /sub1;\n     echo_location /sub2;\n     echo "took $echo_timer_elapsed sec for total.";\n }\n location /sub1 {\n     echo_sleep 2;\n }\n location /sub2 {\n     echo_sleep 1;\n }\n')])])]),t("p",[e._v("可以通过第二个参数传"),t("code",[e._v("querystring")]),e._v(": "),t("code",[e._v("echo_location_async /sub 'foo=Foo&bar=Bar';")])]),e._v(" "),t("h3",{attrs:{id:"echo-foreach-split-分隔循环"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#echo-foreach-split-分隔循环"}},[e._v("#")]),e._v(" echo_foreach_split - 分隔循环")]),e._v(" "),t("ul",[t("li",[e._v("语法: "),t("code",[e._v("echo_foreach_split <delimiter> <string>")])])]),e._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("location /split {\n    echo_foreach_split ',' $arg_list;\n        echo \"item: $echo_it\";\n    echo_end;\n}\n")])])]),t("p",[e._v("上面配置当访问: "),t("code",[e._v("/split?list=cat,dog,mouse")]),e._v(" 时会输出:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("item: cat\nitem: dog\nitem: mouse\n")])])]),t("p",[t("code",[e._v("$arg_list")]),e._v("是对应"),t("code",[e._v("$args.list")])]),e._v(" "),t("p",[e._v("那么配置全"),t("code",[e._v("echo_location_async")]),e._v("可以做成"),t("code",[e._v("nginx-combo")]),e._v("服务了，如:")]),e._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("location = /api/combo {\n    echo_foreach_split ',' $query_string;\n        echo \"/* combo: $echo_it */\";\n        echo_location_async $echo_it;\n        echo;\n    echo_end;\n}\n")])])]),t("p",[e._v("访问: "),t("code",[e._v("/api/combo?/a.js,/b.js")]),e._v("，需要注意的是文件的路径必须以"),t("code",[e._v("/")]),e._v("开始，因为匹配的"),t("code",[e._v("location")]),e._v("，当然真的 "),t("code",[e._v("nginx-combo")]),e._v(" 服务请看: "),t("RouterLink",{attrs:{to:"/example/http-concat.html"}},[e._v("nginx-http-concat")])],1),e._v(" "),t("hr"),e._v(" "),t("p",[e._v("其他变量请去官网查看~")]),e._v(" "),t("h2",{attrs:{id:"link"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#link"}},[e._v("#")]),e._v(" link")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/openresty/echo-nginx-module",target:"_blank",rel:"noopener noreferrer"}},[e._v("官网"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"//echo.xuexb.com"}},[e._v("我写的在线Demo")])])])])}),[],!1,null,null,null);o.default=n.exports}}]);